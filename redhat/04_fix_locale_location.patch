Author: <benoit.mortier@opensides.be>
Description: Fixed location of auto-generated locales
Index: pkg/core/update-fusiondirectory
===================================================================
--- core/update-fusiondirectory	2011-03-16 00:46:14.000000000 +0100
+++ pkg/core/update-fusiondirectory	2011-03-16 00:55:38.000000000 +0100
@@ -169,20 +169,20 @@
 
 	/* For each language, merge the target .mo to the compiled directory. */
 	foreach ($languages as $language => $po_files){
-		if (!is_dir(LOCALE_DIR."/compiled/${language}/LC_MESSAGES")){
-			if (!mkdir (LOCALE_DIR."/compiled/${language}/LC_MESSAGES", 0755, TRUE)){
-				echo "Failed to create '".LOCALE_DIR."/compiled/${language}/LC_MESSAGES'- aborted";
+		if (!is_dir("/var/cache/fusiondirectory/locale/${language}/LC_MESSAGES")){
+			if (!mkdir ("/var/cache/fusiondirectory/locale/${language}/LC_MESSAGES", 0755, TRUE)){
+				echo "Failed to create '/var/cache/fusiondirectory/locale/${language}/LC_MESSAGES'- aborted";
 				exit (3);
 			}
 		}
 
 		/* Cat all these po files into one single file */
-		system ("(cd ".LOCALE_DIR." && msgcat --use-first ".implode(" ", $po_files)." > compiled/${language}/LC_MESSAGES/messages.po)", $val);
+		system ("(cd ".LOCALE_DIR." && msgcat --use-first ".implode(" ", $po_files)." > /var/cache/fusiondirectory/locale/${language}/LC_MESSAGES/messages.po)", $val);
 		if ($val != 0){
 			echo "Merging of message files failed - aborted";
 			exit (4);
 		}
-		system ("(cd ".LOCALE_DIR."/compiled/${language}/LC_MESSAGES && msgfmt -o messages.mo messages.po && rm messages.po)", $val);
+		system ("(cd /var/cache/fusiondirectory/locale/${language}/LC_MESSAGES && msgfmt -o messages.mo messages.po && rm messages.po)", $val);
 		if ($val != 0){
 			echo "Compiling of message files failed - aborted";
 			exit (5);
Index: pkg/core/include/php_setup.inc
===================================================================
--- core/include/php_setup.inc	2011-03-16 00:56:18.000000000 +0100
+++ pkg/core/include/php_setup.inc	2011-03-16 00:56:46.000000000 +0100
@@ -20,7 +20,8 @@
   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
 
-define ("LOCALE_DIR", dirname(dirname(__FILE__))."/locale/compiled");
+
+define ("LOCALE_DIR", "/var/cache/fusiondirectory/locale");
 
 function gosaRaiseError($errno, $errstr, $errfile, $errline)
 {
